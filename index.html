<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>NextPoly - Final</title>
<style>
    body { margin:0; background:#e9e4d8; font-family:Arial, sans-serif; display:flex; flex-direction:column; align-items:center; padding:20px; }
    #board-wrapper { width:500px; height:500px; position:relative; transform-origin:top center; }
    #board { width:500px; height:500px; background:#f4ecd8; border:4px solid #000; display:grid; grid-template-columns:repeat(11,1fr); grid-template-rows:repeat(11,1fr); box-sizing:border-box; position:relative; }
    .tile{ border:1px solid #000; background:#fff; display:flex; flex-direction:column; padding:2px; box-sizing:border-box; justify-content:space-between; text-align:center; font-size:11px; position:relative; }
    .price{ font-size:10px; font-weight:bold; } .label{ font-size:12px; font-weight:bold; }
    .owner{ position:absolute; width:100%; height:4px; bottom:0; left:0; }
    #center{ grid-row:2/11; grid-column:2/11; display:flex; justify-content:center; align-items:center; font-size:40px; font-weight:bold; pointer-events:none; opacity:.2; }
    .token{ width:20px; height:20px; border-radius:50%; position:absolute; transition:all .18s linear; z-index:2; }
    #player{ background:blue; } #computer{ background:red; }
    #controls{ margin-top:12px; display:flex; gap:10px; align-items:center; }
    button{ padding:8px 12px; font-size:14px; cursor:pointer; }
    #info{ margin-top:10px; font-weight:bold; display:flex; gap:20px; align-items:center; }
    #notification{ margin-top:8px; font-weight:bold; min-height:18px; }
    #helpBox{ display:none; margin-top:10px; border:1px solid #000; padding:10px; background:#fff; }
    .card-popup{ position:absolute; display:none; z-index:50; text-align:center; cursor:pointer; left:50%; transform:translateX(-50%); }
    .card-back{ width:140px; height:90px; border-radius:8px; display:flex; align-items:center; justify-content:center; color:#fff; font-weight:bold; }
    .card-zoom{ width:300px; min-height:140px; padding:18px; border-radius:10px; background:#fff; border:6px solid blue; box-shadow:0 8px 24px rgba(0,0,0,.25); font-size:20px; z-index:100; }
    .card-reveal{ width:260px; min-height:100px; padding:10px; border-radius:8px; background:#fff; border:4px solid red; font-size:18px; z-index:100; }
    #decks{ margin-top:10px; display:flex; gap:12px; align-items:center; position:relative; }
    .deck{ width:140px; height:90px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-weight:bold; color:#fff; cursor:pointer; user-select:none; }
    .deck.chance{ background:blue; } .deck.comm{ background:red; }
    #getCardHint{ display:none; margin-top:6px; font-weight:bold; color:#111; }
    @media (max-width:550px){ #board-wrapper{ transform:scale(.9); } } @media (max-width:480px){ #board-wrapper{ transform:scale(.8); } } @media (max-width:420px){ #board-wrapper{ transform:scale(.7); } } @media (max-width:360px){ #board-wrapper{ transform:scale(.6); } }
</style>
</head>
<body>

<div id="board-wrapper">
    <div id="board">
        <!-- ROW ATAS -->
        <div class="tile"><div class="price">$0</div><div class="label">GO</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$60</div><div class="label">Pro1</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$0</div><div class="label">Cha</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$60</div><div class="label">Pro2</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$200</div><div class="label">Tax</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$200</div><div class="label">Rail1</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$100</div><div class="label">Pro3</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$0</div><div class="label">Com</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$100</div><div class="label">Pro4</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$0</div><div class="label">Jail</div><div class="owner"></div></div>

        <!-- SISI KANAN -->
        <div class="tile"><div class="price">$140</div><div class="label">Pro5</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$0</div><div class="label">Cha</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$140</div><div class="label">Pro6</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$160</div><div class="label">Pro7</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$200</div><div class="label">Rail2</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$180</div><div class="label">Pro8</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$0</div><div class="label">Com</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$200</div><div class="label">Pro9</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$0</div><div class="label">GoJ</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$50</div><div class="label">ExtraR</div><div class="owner"></div></div>

        <!-- BOTTOM SIDE -->
        <div class="tile"><div class="price">$0</div><div class="label">Free</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$220</div><div class="label">Pro10</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$0</div><div class="label">Cha</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$220</div><div class="label">Pro11</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$240</div><div class="label">Pro12</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$200</div><div class="label">Rail3</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$260</div><div class="label">Pro13</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$260</div><div class="label">Pro14</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$280</div><div class="label">Pro15</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$0</div><div class="label">GO</div><div class="owner"></div></div>

        <!-- LEFT SIDE -->
        <div class="tile"><div class="price">$0</div><div class="label">Jail</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$300</div><div class="label">Pro16</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$300</div><div class="label">Pro17</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$320</div><div class="label">Pro18</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$200</div><div class="label">Rail4</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$350</div><div class="label">Pro19</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$0</div><div class="label">Com</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$400</div><div class="label">Pro20</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$0</div><div class="label">Tax</div><div class="owner"></div></div>
        <div class="tile"><div class="price">$50</div><div class="label">ExtraL</div><div class="owner"></div></div>

        <div id="center">NextPoly</div>
        <div id="player" class="token"></div>
        <div id="computer" class="token"></div>
    </div>
</div>

<!-- controls + money display -->
<div id="controls">
    <button id="rollBtn">Roll Dice</button>
    <button id="helpBtn">?</button>
</div>

<div id="info">
    <div>Blue = Player | Red = Computer</div>
    <div style="display:flex; gap:10px; margin-left:10px; align-items:center;">
        <div>Player: <span id="moneyP">$1000</span></div>
        <div>Computer: <span id="moneyC">$1000</span></div>
    </div>
</div>

<div id="notification"></div>
<div id="turnIndicator">Turn: Player</div>

<div id="helpBox">
    Klik tombol "Roll Dice" untuk melempar dadu.<br>
    Token bergerak sesuai angka dadu.<br>
    Blue = Player | Red = Computer.
</div>

<!-- decks under the board -->
<div id="decks">
    <div class="deck chance" id="deckChance">Chance (Blue)</div>
    <div class="deck comm" id="deckComm">Community (Red)</div>
</div>
<div id="getCardHint"><span id="hintText"></span></div>

<!-- popup container (used for zoom and computer flip) -->
<div id="cardPopup" class="card-popup"></div>

<script>
/* ---------------------
   Elements & state
   --------------------- */
const rollBtn = document.getElementById('rollBtn');
const helpBtn = document.getElementById('helpBtn');
const helpBox = document.getElementById('helpBox');
const turnIndicator = document.getElementById('turnIndicator');
const notification = document.getElementById('notification');
const cardPopup = document.getElementById('cardPopup');
const deckChanceEl = document.getElementById('deckChance');
const deckCommEl = document.getElementById('deckComm');
const getCardHint = document.getElementById('getCardHint');
const hintText = document.getElementById('hintText');

let playerPos = 0;
let computerPos = 0;
const totalTiles = 40;
let isPlayerTurn = true;

const playerToken = document.getElementById('player');
const computerToken = document.getElementById('computer');
const board = document.getElementById('board');
const tiles = Array.from(document.getElementsByClassName('tile'));
const tileSize = board.offsetWidth / 11;

let owners = Array(totalTiles).fill(null);

let playerMoney = 1000;
let computerMoney = 1000;
const moneyP = document.getElementById("moneyP");
const moneyC = document.getElementById("moneyC");
function updateMoneyUI(){ moneyP.innerText = "$" + playerMoney; moneyC.innerText = "$" + computerMoney; }
updateMoneyUI();

/* ---------------------
   Card decks & shuffle
   --------------------- */
let chanceCards = [
    { text: "Advance to GO", action: (who)=>{ if(who==='player'){ playerPos=0; moveTokenInstant(playerToken,0,false); updateNotification("Player moves to GO"); } else { computerPos=0; moveTokenInstant(computerToken,0,false); updateNotification("Computer moves to GO"); } } },
    { text: "Pay $50", action: (who)=>{ if(who==='player'){ playerMoney-=50; updateMoneyUI(); updateNotification("Player pays $50"); } else { computerMoney-=50; updateMoneyUI(); updateNotification("Computer pays $50"); } } },
    { text: "Receive $100", action: (who)=>{ if(who==='player'){ playerMoney+=100; updateMoneyUI(); updateNotification("Player receives $100"); } else { computerMoney+=100; updateMoneyUI(); updateNotification("Computer receives $100"); } } }
];
let communityCards = [
    { text: "Receive $50", action: (who)=>{ if(who==='player'){ playerMoney+=50; updateMoneyUI(); updateNotification("Player receives $50"); } else { computerMoney+=50; updateMoneyUI(); updateNotification("Computer receives $50"); } } },
    { text: "Go to Jail", action: (who)=>{ if(who==='player'){ playerPos=30; moveTokenInstant(playerToken,30,false); updateNotification("Player goes to Jail"); } else { computerPos=30; moveTokenInstant(computerToken,30,false); updateNotification("Computer goes to Jail"); } } },
    { text: "Pay $30", action: (who)=>{ if(who==='player'){ playerMoney-=30; updateMoneyUI(); updateNotification("Player pays $30"); } else { computerMoney-=30; updateMoneyUI(); updateNotification("Computer pays $30"); } } }
];

function shuffle(arr){ for(let i=arr.length-1;i>0;i--){ let j=Math.floor(Math.random()*(i+1)); [arr[i],arr[j]]=[arr[j],arr[i]]; } }
shuffle(chanceCards); shuffle(communityCards);

// flags for player to be allowed to take card
let getCardAllowed = { chance:false, comm:false };

/* ---------------------
   Helpers
   --------------------- */
function updateNotification(msg){ notification.innerText = msg; }
function checkBankrupt(){
    if(playerMoney <= 0){ updateNotification("Player is bankrupt — Computer wins"); rollBtn.disabled = true; return true; }
    if(computerMoney <= 0){ updateNotification("Computer is bankrupt — Player wins"); rollBtn.disabled = true; return true; }
    return false;
}
function getTilePosition(index){ let row=0,col=0; if(index<10){row=0; col=index;} else if(index<19){row=index-9; col=10;} else if(index<29){row=10; col=28-index;} else{row=39-index; col=0;} return {top:row*tileSize, left:col*tileSize}; }

/* ---------------------
   Movement: step-by-step
   --------------------- */
function moveTokenInstant(token, position, triggerTile=true){
    const pos = getTilePosition(position);
    token.style.top = pos.top + 'px';
    token.style.left = pos.left + 'px';
    if(triggerTile){
        // small timeout then handle tile (avoid immediate double triggers)
        setTimeout(()=> handleTileByIndex(token, position), 80);
    }
}

function moveStep(token, current, target, callback){
    if(current === target){ callback(); return; }
    const next = (current + 1) % totalTiles;
    moveTokenInstant(token, next, false);
    setTimeout(()=> moveStep(token, next, target, callback), 120);
}

function moveTokenSmooth(token, from, to, callback){
    moveStep(token, from, to, callback);
}

/* ---------------------
   Show card logic
   --------------------- */
function showCardImmediate(deck, who){ // internal use (computer auto)
    if(!deck || deck.length===0) return;
    const card = deck.shift(); deck.push(card);
    cardPopup.innerHTML=''; cardPopup.style.top = (board.getBoundingClientRect().bottom + 20) + 'px'; cardPopup.style.display='block';
    if(who==='computer'){
        const back = document.createElement('div'); back.className='card-back'; back.style.background='red'; back.innerHTML='<div style="font-size:16px">NextPoly</div>';
        cardPopup.appendChild(back);
        setTimeout(()=>{ cardPopup.innerHTML=''; const reveal=document.createElement('div'); reveal.className='card-reveal'; reveal.innerHTML=`<div style="font-size:16px;color:red;font-weight:bold;margin-bottom:8px">NextPoly</div><div>${card.text}</div>`; cardPopup.appendChild(reveal);
            setTimeout(()=>{ card.action('computer'); cardPopup.style.display='none'; checkBankrupt(); },900);
        },600);
    } else {
        // player direct apply (not used normally)
        cardPopup.innerHTML = `<div class="card-zoom" style="border-color:blue"><div style="font-size:16px;color:blue;font-weight:bold;margin-bottom:8px">NextPoly</div><div>${card.text}</div><div style="font-size:12px;margin-top:8px;color:#666">Click to apply</div></div>`;
        cardPopup.onclick = ()=>{ card.action('player'); cardPopup.style.display='none'; cardPopup.onclick=null; checkBankrupt(); };
    }
}

// show card when player clicks deck (uses getCardAllowed flags)
deckChanceEl.addEventListener('click', ()=>{
    if(getCardAllowed.chance){
        getCardAllowed.chance = false;
        hideGetCardHint();
        showCardForPlayerOrComputer(chanceCards, 'player', deckChanceEl);
    } else {
        const back = document.createElement('div'); back.className='card-back'; back.style.background='blue'; back.innerHTML='<div style="font-size:16px">NextPoly</div>';
        cardPopup.innerHTML=''; cardPopup.appendChild(back); cardPopup.style.top=(board.getBoundingClientRect().bottom+10)+'px'; cardPopup.style.display='block'; setTimeout(()=>cardPopup.style.display='none',700);
    }
});
deckCommEl.addEventListener('click', ()=>{
    if(getCardAllowed.comm){
        getCardAllowed.comm = false;
        hideGetCardHint();
        showCardForPlayerOrComputer(communityCards, 'player', deckCommEl);
    } else {
        const back = document.createElement('div'); back.className='card-back'; back.style.background='red'; back.innerHTML='<div style="font-size:16px">NextPoly</div>';
        cardPopup.innerHTML=''; cardPopup.appendChild(back); cardPopup.style.top=(board.getBoundingClientRect().bottom+10)+'px'; cardPopup.style.display='block'; setTimeout(()=>cardPopup.style.display='none',700);
    }
});

function showCardForPlayerOrComputer(deck, who, deckEl){
    if(!deck || deck.length===0) return;
    const card = deck.shift(); deck.push(card);
    cardPopup.innerHTML=''; cardPopup.style.top = (board.getBoundingClientRect().bottom + 20) + 'px'; cardPopup.style.display='block';
    if(who === 'computer'){
        const back = document.createElement('div'); back.className='card-back'; back.style.background='red'; back.innerHTML='<div style="font-size:16px">NextPoly</div>';
        cardPopup.appendChild(back);
        setTimeout(()=>{ cardPopup.innerHTML=''; const reveal=document.createElement('div'); reveal.className='card-reveal'; reveal.innerHTML=`<div style="font-size:16px;color:red;font-weight:bold;margin-bottom:8px">NextPoly</div><div>${card.text}</div>`; cardPopup.appendChild(reveal);
            setTimeout(()=>{ card.action('computer'); cardPopup.style.display='none'; checkBankrupt(); },900);
        },600);
    } else {
        const zoom = document.createElement('div'); zoom.className='card-zoom'; zoom.style.borderColor='blue';
        zoom.innerHTML = `<div style="font-size:16px;color:blue;font-weight:bold;margin-bottom:8px">NextPoly</div><div>${card.text}</div><div style="font-size:12px;margin-top:8px;color:#666">Click card to close and apply</div>`;
        cardPopup.appendChild(zoom);
        cardPopup.onclick = ()=>{ card.action('player'); cardPopup.style.display='none'; cardPopup.onclick=null; checkBankrupt(); };
    }
}

/* ---------------------
   Tile handlers (manual mapping by index)
   --------------------- */
// mapping used:
// 0 GO, 1 Pro1,2 Cha,3 Pro2,4 Tax,5 Rail1,6 Pro3,7 Com,8 Pro4,9 Jail
// 10 Pro5,11 Cha,12 Pro6,13 Pro7,14 Rail2,15 Pro8,16 Com,17 Pro9,18 GoJ,19 ExtraR
// 20 Free,21 Pro10,22 Cha,23 Pro11,24 Pro12,25 Rail3,26 Pro13,27 Pro14,28 Pro15,29 GO
// 30 Jail,31 Pro16,32 Pro17,33 Pro18,34 Rail4,35 Pro19,36 Com,37 Pro20,38 Tax,39 ExtraL

function handleTileByIndex(token, index){
    // reset get-card flags each time unless tile sets them
    getCardAllowed.chance = false; getCardAllowed.comm = false; hideGetCardHint();

    switch(index){
        case 0: handleGO(token); break;
        case 1: handleProperty(token,1); break;
        case 2: handleChance(token); break;
        case 3: handleProperty(token,2); break;
        case 4: handleTax(token); break;
        case 5: handleRail(token,1); break;
        case 6: handleProperty(token,3); break;
        case 7: handleCommunity(token); break;
        case 8: handleProperty(token,4); break;
        case 9: handleJailVisit(token); break;

        case 10: handleProperty(token,5); break;
        case 11: handleChance(token); break;
        case 12: handleProperty(token,6); break;
        case 13: handleProperty(token,7); break;
        case 14: handleRail(token,2); break;
        case 15: handleProperty(token,8); break;
        case 16: handleCommunity(token); break;
        case 17: handleProperty(token,9); break;
        case 18: handleGoToJail(token); break;
        case 19: handleExtraR(token); break;

        case 20: handleFree(token); break;
        case 21: handleProperty(token,10); break;
        case 22: handleChance(token); break;
        case 23: handleProperty(token,11); break;
        case 24: handleProperty(token,12); break;
        case 25: handleRail(token,3); break;
        case 26: handleProperty(token,13); break;
        case 27: handleProperty(token,14); break;
        case 28: handleProperty(token,15); break;
        case 29: handleGO(token); break;

        case 30: handleJailVisit(token); break;
        case 31: handleProperty(token,16); break;
        case 32: handleProperty(token,17); break;
        case 33: handleProperty(token,18); break;
        case 34: handleRail(token,4); break;
        case 35: handleProperty(token,19); break;
        case 36: handleCommunity(token); break;
        case 37: handleProperty(token,20); break;
        case 38: handleTax(token); break;
        case 39: handleExtraL(token); break;

        default: updateNotification('Unknown tile'); break;
    }
}

/* ---------------------
   Individual handlers
   --------------------- */
function handleGO(token){
    // give $200 when landing on GO
    const bonus = 200;
    if(token.id === 'player'){ playerMoney += bonus; updateMoneyUI(); updateNotification('Player collects $200'); }
    else { computerMoney += bonus; updateMoneyUI(); updateNotification('Computer collects $200'); }
    checkBankrupt();
}

function handleProperty(token, propNumber){
    const index = findIndexByPropertyNumber(propNumber);
    if(index === -1){ updateNotification('Property mapping error'); return; }

    if(!owners[index]){
        if(token.id === 'player'){
            const price = getPriceForProperty(propNumber);
            if(confirm(`Buy Pro${propNumber} for $${price}?`)){
                if(playerMoney >= price){
                    playerMoney -= price;
                    owners[index] = 'player';
                    tiles[index].querySelector('.owner').style.background = 'blue';
                    updateMoneyUI();
                    updateNotification(`Player bought Pro${propNumber}`);
                } else updateNotification('Not enough money');
            } else updateNotification('Player declined to buy');
        } else {
            const price = getPriceForProperty(propNumber);
            if(computerMoney >= price && computerMoney - price >= 200){
                computerMoney -= price;
                owners[index] = 'computer';
                tiles[index].querySelector('.owner').style.background = 'red';
                updateMoneyUI();
                updateNotification(`Computer bought Pro${propNumber}`);
            } else updateNotification('Computer declined to buy');
        }
    } else if(owners[index] !== token.id){
        const rent = Math.max(50, Math.round(getPriceForProperty(propNumber) * 0.25));
        if(token.id === 'player'){ playerMoney -= rent; computerMoney += rent; updateNotification(`Player pays rent $${rent}`); }
        else { computerMoney -= rent; playerMoney += rent; updateNotification(`Computer pays rent $${rent}`); }
        updateMoneyUI();
        checkBankrupt();
    } else {
        updateNotification('You own this property');
    }
}

function handleChance(token){
    if(token.id === 'player'){
        getCardAllowed.chance = true; showGetCardHint('Get a card: Chance (click deck)');
        updateNotification('You landed on Chance — click the Chance deck below');
    } else {
        showCardForPlayerOrComputer(chanceCards, 'computer', deckChanceEl);
    }
}

function handleCommunity(token){
    if(token.id === 'player'){
        getCardAllowed.comm = true; showGetCardHint('Get a card: Community (click deck)');
        updateNotification('You landed on Community — click the Community deck below');
    } else {
        showCardForPlayerOrComputer(communityCards, 'computer', deckCommEl);
    }
}

function handleTax(token){
    const tax = 200;
    if(token.id === 'player'){ playerMoney -= tax; updateNotification(`Player pays tax $${tax}`); } else { computerMoney -= tax; updateNotification(`Computer pays tax $${tax}`); }
    updateMoneyUI(); checkBankrupt();
}

function handleRail(token, railNumber){
    const index = findRailIndex(railNumber);
    if(index === -1){ updateNotification('Rail mapping error'); return; }
    if(!owners[index]){
        const price = 200;
        if(token.id === 'player'){
            if(confirm(`Buy Rail${railNumber} for $${price}?`)){
                if(playerMoney >= price){ playerMoney -= price; owners[index] = 'player'; tiles[index].querySelector('.owner').style.background='blue'; updateMoneyUI(); updateNotification(`Player bought Rail${railNumber}`); }
                else updateNotification('Not enough money');
            } else updateNotification('Player declined to buy rail');
        } else {
            if(computerMoney >= price && computerMoney - price >= 200){ computerMoney -= price; owners[index] = 'computer'; tiles[index].querySelector('.owner').style.background='red'; updateMoneyUI(); updateNotification(`Computer bought Rail${railNumber}`); }
            else updateNotification('Computer declined to buy rail');
        }
    } else if(owners[index] !== token.id){
        const rent = 100;
        if(token.id==='player'){ playerMoney -= rent; computerMoney += rent; updateNotification(`Player pays rail rent $${rent}`); } else { computerMoney -= rent; playerMoney += rent; updateNotification(`Computer pays rail rent $${rent}`); }
        updateMoneyUI(); checkBankrupt();
    } else {
        updateNotification('You own this rail');
    }
}

function handleFree(token){ updateNotification('Free Parking — nothing happens'); }

function handleJailVisit(token){ updateNotification('Jail (visiting) — no penalty'); }

function handleGoToJail(token){
    updateNotification('Go to Jail! Sending to Jail...');
    if(token.id === 'player'){ playerPos = 30; moveTokenInstant(playerToken,30,false); } else { computerPos = 30; moveTokenInstant(computerToken,30,false); }
    // landing in jail handled but don't re-trigger other tiles
}

function handleExtraR(token){
    const bonus = 100;
    if(token.id === 'player'){ playerMoney += bonus; updateNotification(`Player receives ExtraR bonus $${bonus}`); } else { computerMoney += bonus; updateNotification(`Computer receives ExtraR bonus $${bonus}`); }
    updateMoneyUI(); checkBankrupt();
}

function handleExtraL(token){
    // same effect as ExtraR per request
    const bonus = 100;
    if(token.id === 'player'){ playerMoney += bonus; updateNotification(`Player receives ExtraL bonus $${bonus}`); } else { computerMoney += bonus; updateNotification(`Computer receives ExtraL bonus $${bonus}`); }
    updateMoneyUI(); checkBankrupt();
}

/* ---------------------
   Utility mapping functions
   --------------------- */
function findIndexByPropertyNumber(propNumber){
    const map = {
        1:1,2:3,3:6,4:8,5:10,6:12,7:13,8:15,9:17,
        10:21,11:23,12:24,13:26,14:27,15:28,16:31,17:32,18:33,19:35,20:37
    };
    return map[propNumber] ?? -1;
}
function getPriceForProperty(propNumber){
    const priceMap = {1:60,2:60,3:100,4:100,5:140,6:140,7:160,8:180,9:200,10:220,11:220,12:240,13:260,14:260,15:280,16:300,17:300,18:320,19:350,20:400};
    return priceMap[propNumber] ?? 100;
}
function findRailIndex(railNumber){ const map = {1:5,2:14,3:25,4:34}; return map[railNumber] ?? -1; }

/* ---------------------
   Get Card hint UI
   --------------------- */
function showGetCardHint(text){ hintText.innerText = text; getCardHint.style.display = 'block'; }
function hideGetCardHint(){ hintText.innerText=''; getCardHint.style.display = 'none'; }

/* ---------------------
   Turn system (uses step movement)
   --------------------- */
rollBtn.addEventListener('click', ()=>{
    if(!isPlayerTurn) return;
    if(rollBtn.disabled) return;
    const dice = Math.floor(Math.random()*6)+1;
    const target = (playerPos + dice) % totalTiles;

    moveTokenSmooth(playerToken, playerPos, target, ()=>{
        playerPos = target;
        handleTileByIndex(playerToken, playerPos);
        if(checkBankrupt()) return;

        // computer turn
        turnIndicator.innerText = 'Turn: Computer';
        isPlayerTurn = false;

        setTimeout(()=>{
            const cdice = Math.floor(Math.random()*6)+1;
            const ctarget = (computerPos + cdice) % totalTiles;
            moveTokenSmooth(computerToken, computerPos, ctarget, ()=>{
                computerPos = ctarget;
                handleTileByIndex(computerToken, computerPos);
                checkBankrupt();
                turnIndicator.innerText = 'Turn: Player';
                isPlayerTurn = true;
            });
        }, 800);
    });
});

/* ---------------------
   Help button
   --------------------- */
helpBtn.addEventListener('click', ()=> {
    helpBox.style.display = helpBox.style.display === 'none' ? 'block' : 'none';
});

/* ---------------------
   Initial placement
   --------------------- */
moveTokenInstant(playerToken, 0, false);
moveTokenInstant(computerToken, 0, false);

</script>
</body>
    </html>
