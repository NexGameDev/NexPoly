<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Classic-style Mini Monopoly (Full board)</title>
<style>
  :root{
    --bg:#071223;
    --panel:#03121a;
    --muted:#a8b6c4;
    --accent:#f59e0b;
    --board-max:980px;
    --cell-min:44px;
    /* classic-like colors */
    --brown:#8b5a2b;
    --lightblue:#3aa0ff;
    --pink:#d06aa7;
    --orange:#f28c2b;
    --red:#e03b3b;
    --yellow:#f5d23b;
    --green:#2bb673;
    --blue:#1f4fb4;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{height:100%;background:linear-gradient(#071223,#03121a);color:#e6f3ff;font-family:Inter,system-ui,Segoe UI,Roboto,Arial}
  .wrap{max-width:var(--board-max);margin:12px auto;padding:10px;display:grid;grid-template-columns:1fr 360px;gap:12px}
  @media (max-width:980px){ .wrap{grid-template-columns:1fr} }
  .board-wrap{width:100%;overflow:auto;border-radius:10px}
  /* board is square, uses 11x11 grid. center 9x9 kept empty */
  .board{width:100%;aspect-ratio:1/1;display:grid;grid-template-columns:repeat(11,1fr);grid-template-rows:repeat(11,1fr);gap:6px;padding:8px;background:linear-gradient(180deg,#0b1724,#071226);border-radius:10px}
  .cell{background:linear-gradient(180deg,#082033,#071226);border-radius:6px;padding:6px;display:flex;flex-direction:column;justify-content:space-between;color:#e6f3ff;min-width:var(--cell-min);min-height:var(--cell-min);font-size:12px}
  .corner{background:linear-gradient(180deg,#102b3b,#071726);font-weight:800;display:flex;align-items:center;justify-content:center;text-align:center;padding:6px}
  .edge-title{font-weight:700;font-size:11px;line-height:1;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
  .edge-vertical{writing-mode:vertical-rl;transform:rotate(180deg);text-align:center}
  .edge-horizontal{text-align:center}
  .prop-bar{height:10px;border-radius:4px;margin-bottom:6px;width:100%}
  .price{font-size:11px;color:var(--muted)}
  .players-on{display:flex;gap:4px;margin-top:6px;flex-wrap:wrap}
  .pawn{width:16px;height:16px;border-radius:50%;display:inline-block;border:2px solid #071726}
  .cell.clickable{cursor:pointer}
  /* center area (9x9) blank visually */
  .center-blank{grid-column:2 / span 9; grid-row:2 / span 9; background:transparent; box-shadow:none; border-radius:6px; pointer-events:none}

  /* sidebar */
  .panel{background:linear-gradient(180deg,var(--panel),#02101a);border-radius:10px;padding:12px}
  .players-list{display:flex;flex-direction:column;gap:8px;margin-bottom:10px}
  .player{display:flex;align-items:center;gap:8px;padding:8px;border-radius:8px;background:rgba(255,255,255,0.02)}
  .player.active{outline:2px solid rgba(255,255,255,0.04)}
  .controls{display:flex;gap:8px;margin-bottom:10px;flex-wrap:wrap}
  button{background:var(--accent);border:none;color:#071726;font-weight:700;padding:8px 10px;border-radius:8px;cursor:pointer}
  button.alt{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,0.04)}
  .log{background:rgba(255,255,255,0.02);padding:8px;height:240px;overflow:auto;border-radius:8px;font-size:13px;color:#cbe7ff}
  .small{font-size:13px;color:var(--muted)}
  .prop-list{margin-top:8px;font-size:13px;color:var(--muted)}

  /* small screens tweaks */
  @media (max-width:420px){
    .pawn{width:14px;height:14px}
    button{padding:7px 8px;font-size:13px}
  }
</style>
</head>
<body>
  <div class="wrap">
    <div class="board-wrap" role="region" aria-label="Monopoly board">
      <div class="board" id="board"></div>
    </div>

    <aside class="panel" aria-label="Game controls">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <h3 style="margin:0">Classic Mini Monopoly</h3>
        <div class="small">Full board â€¢ Mobile</div>
      </div>

      <div style="display:flex;gap:8px;margin-bottom:8px">
        <button id="addAI" class="alt">Add CPU</button>
        <button id="reset" class="alt">Reset</button>
      </div>

      <div class="players-list" id="playersList"></div>

      <div class="controls">
        <button id="rollBtn">Roll Dice</button>
        <button id="buyBtn" class="alt">Buy</button>
        <button id="endBtn" class="alt">End Turn</button>
      </div>

      <div class="small">Dice: <strong id="dice">-</strong></div>
      <div class="small">Turn: <strong id="turn">-</strong></div>
      <div class="small" style="margin-bottom:8px">Bank: <strong id="bank">Rp 0</strong></div>

      <div style="margin-top:8px;font-weight:700">Tile Info</div>
      <div id="propInfo" class="prop-list">Tap a tile or land on it to view details.</div>

      <div style="margin-top:10px;font-weight:700">Log</div>
      <div class="log" id="log"></div>
    </aside>
  </div>

<script>
/* Full classic-like board render + abbreviations + simple AI
   - 11x11 visual grid, 40 tiles around edges
   - center 9x9 left empty (visual)
   - auto-abbreviate long labels using mapping or trimming
*/

/* ---------- Data ---------- */
const boardEl = document.getElementById('board');
const logEl = document.getElementById('log');
const maxPos = 40;

/* mapping of special tiles (classic labels, generic ownership/prices) */
const specialMap = {
  0:{type:'go', name:'GO'},
  4:{type:'tax', name:'Income Tax', note:'Pay Rp 200'},
  7:{type:'chance', name:'Chance'},
  10:{type:'jail', name:'Jail (Just Visiting)'},
  12:{type:'utility', name:'Electric Company'},
  17:{type:'community', name:'Community Chest'},
  20:{type:'free', name:'Free Parking'},
  22:{type:'chance', name:'Chance'},
  30:{type:'gotojail', name:'Go To Jail'},
  33:{type:'community', name:'Community Chest'},
  36:{type:'chance', name:'Chance'}
};

/* color groups (positions chosen to mimic classic distribution) */
const colorGroups = {
  brown:[1,3],
  lightblue:[6,8,9],
  pink:[11,13,14],
  orange:[16,18,19],
  red:[21,23,24],
  yellow:[26,27,29],
  green:[31,32,34],
  blue:[37,38,39]
};

/* prepare properties array (generic names: Property N) */
const properties = [];
for(let i=0;i<maxPos;i++){
  if(specialMap[i]){
    const s = specialMap[i];
    properties.push({
      id:i,
      name:s.name,
      price: s.type==='go' || s.type==='free' || s.type==='jail' ? 0 : (s.type==='tax'?200: 100 + i*6),
      rent: s.type==='tax'?0: Math.max(10, Math.floor((100 + i*6)/7)),
      owner:null,
      type:s.type
    });
  } else {
    properties.push({
      id:i,
      name:`Property ${i}`,
      price:100 + i*6,
      rent: Math.max(10, Math.floor((100 + i*6)/7)),
      owner:null,
      type:'property'
    });
  }
}

/* abbreviation map (apply before trimming) */
const abbrev = {
  'Property':'Pro',
  'Income Tax':'IncTax',
  'Community Chest':'CMChest',
  'Electric Company':'ElecCo',
  'Go To Jail':'GoToJail',
  'Free Parking':'FreePark',
  'Just Visiting / Jail':'Jail',
  'Jail (Just Visiting)':'Jail'
};

/* ---------- Grid / layout helpers ---------- */
function makeGrid(){
  boardEl.innerHTML = '';
  for(let r=0;r<11;r++){
    for(let c=0;c<11;c++){
      const div = document.createElement('div');
      div.className = 'cell';
      boardEl.appendChild(div);
    }
  }
  // add center blank overlay that occupies center 9x9 visually (so inner cells are empty)
  const center = document.createElement('div');
  center.className = 'center-blank';
  boardEl.appendChild(center);
}
makeGrid();

function edgeCoords(){
  const coords = [];
  for(let x=0;x<11;x++) coords.push([0,x]);           // top 0..10
  for(let y=1;y<11;y++) coords.push([y,10]);         // right 1..10
  for(let x=9;x>=0;x--) coords.push([10,x]);         // bottom 9..0
  for(let y=9;y>=1;y--) coords.push([y,0]);          // left 9..1
  return coords;
}
const coords = edgeCoords();
const posToIndex = coords.map(([r,c])=> r*11 + c);

/* choose color for group */
function groupColor(group){
  switch(group){
    case 'brown': return getComputedStyle(document.documentElement).getPropertyValue('--brown') || '#8b5a2b';
    case 'lightblue': return getComputedStyle(document.documentElement).getPropertyValue('--lightblue') || '#3aa0ff';
    case 'pink': return getComputedStyle(document.documentElement).getPropertyValue('--pink') || '#d06aa7';
    case 'orange': return getComputedStyle(document.documentElement).getPropertyValue('--orange') || '#f28c2b';
    case 'red': return getComputedStyle(document.documentElement).getPropertyValue('--red') || '#e03b3b';
    case 'yellow': return getComputedStyle(document.documentElement).getPropertyValue('--yellow') || '#f5d23b';
    case 'green': return getComputedStyle(document.documentElement).getPropertyValue('--green') || '#2bb673';
    case 'blue': return getComputedStyle(document.documentElement).getPropertyValue('--blue') || '#1f4fb4';
    default: return '#334155';
  }
}

/* find group for a pos */
function findGroup(pos){
  for(const k in colorGroups) if(colorGroups[k].includes(pos)) return k;
  return null;
}

/* shorten a label using map or trimming to fit */
function shortenLabel(text, maxChars){
  if(!text) return '';
  // apply manual abbreviations first
  for(const key in abbrev){
    if(text.toLowerCase().includes(key.toLowerCase())){
      text = text.replace(new RegExp(key,'ig'), abbrev[key]);
    }
  }
  if(text.length <= maxChars) return text;
  // try to shorten by splitting words
  const parts = text.split(' ');
  if(parts.length>1){
    const short = parts.map(p => p.slice(0,3)).join('');
    if(short.length <= maxChars) return short;
  }
  // fallback: trim and add ellipsis
  return text.slice(0, Math.max(0, maxChars-1)) + 'â€¦';
}

/* ---------- Render / UI ---------- */
function renderBoard(){
  const cells = boardEl.querySelectorAll('.cell');
  cells.forEach(c => { c.innerHTML=''; c.classList.remove('corner'); c.classList.remove('clickable'); });

  for(let i=0;i<coords.length;i++){
    const gridIndex = posToIndex[i];
    const el = boardEl.children[gridIndex];
    if(!el) continue;
    el.innerHTML = '';
    if(i%10===0) el.classList.add('corner');

    const side = determineSide(i);
    const title = document.createElement('div');
    // orientation
    title.className = (side==='top' || side==='bottom') ? 'edge-horizontal edge-title' : 'edge-vertical edge-title';

    // color bar if property group
    const group = findGroup(i);
    if(group){
      const bar = document.createElement('div');
      bar.className = 'prop-bar';
      bar.style.background = groupColor(group);
      el.appendChild(bar);
    }

    // compute label and shorten if needed (space differs by side)
    let label = properties[i].name;
    if(abbrev[label]) label = abbrev[label];
    // approximate available chars by side/width (top/bottom horizontal -> more chars)
    const maxChars = (side==='top' || side==='bottom') ? 18 : 9;
    const displayLabel = shortenLabel(label, maxChars);
    title.textContent = displayLabel;
    el.appendChild(title);

    if(properties[i].price > 0){
      const p = document.createElement('div');
      p.className = 'price';
      p.textContent = 'Rp ' + properties[i].price;
      el.appendChild(p);
    } else {
      const info = document.createElement('div');
      info.className = 'small';
      info.textContent = properties[i].type==='tax' ? 'Pay tax' : (properties[i].type==='go' ? 'Collect on pass' : properties[i].type);
      el.appendChild(info);
    }

    const playersHere = document.createElement('div');
    playersHere.className = 'players-on';
    playersHere.dataset.pos = i;
    el.appendChild(playersHere);

    el.classList.add('clickable');
    el.addEventListener('click', ()=> showProp(i));
  }

  updatePlayersOnBoard();
}

/* basic side detection */
function determineSide(pos){
  if(pos>=0 && pos<=10) return 'top';
  if(pos>10 && pos<=20) return 'right';
  if(pos>20 && pos<=30) return 'bottom';
  return 'left';
}

/* ---------- Players & Game logic (simple, includes AI) ---------- */
let players = [
  {id:0,name:'You',color:'#ef4444',pos:0,money:1500,alive:true,isAI:false},
  {id:1,name:'CPU 1',color:'#3b82f6',pos:0,money:1500,alive:true,isAI:true}
];
let currentTurn = 0;
let diceValue = 0;
const bank = {money:999999};

/* render players list */
const playersListEl = document.getElementById('playersList');
function renderPlayersList(){
  playersListEl.innerHTML='';
  players.forEach(p=>{
    const d = document.createElement('div');
    d.className = 'player' + (currentTurn===p.id ? ' active' : '');
    d.innerHTML = `<div style="width:18px;height:18px;border-radius:50%;background:${p.color};border:2px solid #071726"></div>
                   <div style="flex:1">
                     <div style="font-weight:700">${p.name}${p.isAI? ' (CPU)':''}</div>
                     <div class="small">Rp ${p.money}</div>
                   </div>
                   <div class="small">Pos: ${p.pos}</div>`;
    playersListEl.appendChild(d);
  });
  document.getElementById('turn').textContent = players[currentTurn] ? players[currentTurn].name : '-';
  document.getElementById('bank').textContent = 'Rp ' + bank.money;
}

/* update pawns on board */
function updatePlayersOnBoard(){
  const playersOnEls = boardEl.querySelectorAll('.players-on');
  playersOnEls.forEach(el=> el.innerHTML='');
  players.forEach(p=>{
    if(!p.alive) return;
    const pos = p.pos % maxPos;
    const gridIndex = posToIndex[pos];
    const cell = boardEl.children[gridIndex];
    if(!cell) return;
    const playersOn = cell.querySelector('.players-on');
    if(playersOn){
      const pawn = document.createElement('span');
      pawn.className = 'pawn';
      pawn.style.background = p.color;
      pawn.title = p.name;
      playersOn.appendChild(pawn);
    }
  });
}

/* show property info */
function showProp(i){
  const prop = properties[i];
  const el = document.getElementById('propInfo');
  el.innerHTML = `<div style="font-weight:700">${prop.name}</div>
                  <div class="small">Price: Rp ${prop.price} â€¢ Rent: Rp ${prop.rent}</div>
                  <div style="margin-top:6px">${prop.owner===null ? 'Unowned' : 'Owned by ' + (players.find(p=>p.id===prop.owner)?.name || 'Unknown')}</div>
                  <div style="margin-top:6px" class="small">Type: ${prop.type}</div>`;
}

/* logging */
function log(text){
  const p = document.createElement('div');
  p.textContent = text;
  logEl.appendChild(p);
  logEl.scrollTop = logEl.scrollHeight;
}

/* roll dice */
function rollDice(){
  const p = players[currentTurn];
  if(!p || !p.alive) return;
  diceValue = (Math.floor(Math.random()*6)+1) + (Math.floor(Math.random()*6)+1);
  document.getElementById('dice').textContent = diceValue;
  log(`${p.name} rolled ${diceValue}`);
  movePlayer(currentTurn, diceValue);
  renderPlayersList();
}

/* move and resolve landing */
function movePlayer(pid, steps){
  const p = players[pid];
  const prev = p.pos;
  p.pos = (p.pos + steps) % maxPos;

  if(prev + steps >= maxPos || p.pos < prev){
    p.money += 200;
    log(`${p.name} passed GO and collected Rp 200`);
  }

  updatePlayersOnBoard();
  const landed = properties[p.pos];

  if(landed.type === 'tax'){
    p.money -= 200;
    log(`${p.name} landed on Income Tax and paid Rp 200`);
    checkBankrupt(p);
  } else if(landed.type === 'chance' || landed.type === 'community'){
    const rng = Math.random();
    if(rng < 0.5){ p.money += 100; log(`${p.name} got +Rp100 from ${landed.name}`); }
    else { p.money -= 100; log(`${p.name} lost Rp100 from ${landed.name}`); checkBankrupt(p); }
  } else if(landed.type === 'gotojail'){
    p.pos = 10; // jail index
    log(`${p.name} was sent to Jail`);
  } else if(landed.price === 0){
    log(`${p.name} landed on ${landed.name}.`);
  } else if(landed.owner === null){
    log(`${p.name} landed on ${landed.name} â€” available for Rp ${landed.price}.`);
    if(p.isAI){
      setTimeout(()=> aiBuyDecision(p.id, landed.id), 600);
    }
  } else if(landed.owner === p.id){
    log(`${p.name} landed on their own ${landed.name}.`);
  } else {
    const owner = players.find(pl => pl.id === landed.owner);
    const rent = landed.rent;
    p.money -= rent;
    owner.money += rent;
    log(`${p.name} paid Rp ${rent} rent to ${owner.name} (${landed.name}).`);
    checkBankrupt(p);
  }
  renderPlayersList();
}

/* buy */
function buyCurrent(){
  const p = players[currentTurn];
  if(!p || !p.alive) return;
  const prop = properties[p.pos];
  if(prop.price===0){ log('Cannot buy this tile.'); return; }
  if(prop.owner !== null){ log('Property already owned.'); return; }
  if(p.money >= prop.price){
    p.money -= prop.price;
    prop.owner = p.id;
    log(`${p.name} bought ${prop.name} for Rp ${prop.price}.`);
    renderPlayersList();
    showProp(p.pos);
  } else {
    log(`${p.name} cannot afford ${prop.name}.`);
  }
}

/* end turn -> next alive, auto-run AI */
function endTurn(){
  const total = players.length;
  let next = currentTurn;
  for(let i=1;i<=total;i++){
    const cand = (currentTurn + i) % total;
    if(players[cand].alive){ next = cand; break; }
  }
  currentTurn = next;
  renderPlayersList();
  log(`Turn: ${players[currentTurn].name}`);
  if(players[currentTurn].isAI){
    setTimeout(()=> runAIMove(players[currentTurn].id), 700);
  }
}

/* bankrupt */
function checkBankrupt(player){
  if(player.money < 0){
    player.alive = false;
    properties.forEach(prop => { if(prop.owner === player.id) prop.owner = null; });
    log(`${player.name} went bankrupt and is eliminated.`);
    const alive = players.filter(p=>p.alive);
    if(alive.length === 1){
      log(`ðŸ† ${alive[0].name} wins!`);
      document.getElementById('rollBtn').disabled = true;
      document.getElementById('buyBtn').disabled = true;
      document.getElementById('endBtn').disabled = true;
    } else {
      if(!players[currentTurn].alive) endTurn();
    }
  }
}

/* ---------- AI (heuristic) ---------- */
function aiBuyDecision(aiId, propId){
  const ai = players.find(p=>p.id===aiId);
  const prop = properties[propId];
  if(!ai || !prop || prop.owner !== null) return;
  const price = prop.price;
  const rent = prop.rent;
  const group = findGroup(propId);

  let ownInGroup = 0, totalInGroup = 0;
  if(group){
    totalInGroup = colorGroups[group].length;
    colorGroups[group].forEach(pid => { if(properties[pid].owner === aiId) ownInGroup++; });
  }

  const willHave = ai.money - price;
  let decision = false;
  if(willHave < 100) decision = false;
  else if(group && ownInGroup + 1 === totalInGroup) decision = true;
  else if(price <= 180) decision = true;
  else if(rent * 8 > price) decision = true;
  else decision = false;

  if(decision){
    ai.money -= price;
    prop.owner = ai.id;
    log(`${ai.name} (AI) bought ${prop.name} for Rp ${price}`);
  } else {
    log(`${ai.name} (AI) decided NOT to buy ${prop.name}`);
  }
  renderPlayersList();
}

/* run ai turn */
function runAIMove(aiId){
  const idx = players.findIndex(p=>p.id===aiId);
  if(idx === -1) return;
  currentTurn = idx;
  renderPlayersList();
  setTimeout(()=> { rollDice(); setTimeout(()=> endTurn(), 1200); }, 500);
}

/* ---------- Controls ---------- */
document.getElementById('rollBtn').addEventListener('click', ()=> { if(players[currentTurn].isAI) return; rollDice(); });
document.getElementById('buyBtn').addEventListener('click', ()=> { if(players[currentTurn].isAI) return; buyCurrent(); });
document.getElementById('endBtn').addEventListener('click', ()=> { if(players[currentTurn].isAI) return; endTurn(); });

/* add CPU */
document.getElementById('addAI').addEventListener('click', ()=>{
  const newId = players.length ? Math.max(...players.map(p=>p.id)) + 1 : 0;
  const colors = ['#a78bfa','#10b981','#f97316','#06b6d4','#c026d3'];
  players.push({id:newId,name:`CPU ${newId}`,color:colors[newId%colors.length]||'#999999',pos:0,money:1500,alive:true,isAI:true});
  log(`Added CPU ${newId}`);
  renderPlayersList();
});

/* reset */
document.getElementById('reset').addEventListener('click', ()=>{
  properties.forEach(p=> p.owner = null);
  players = [
    {id:0,name:'You',color:'#ef4444',pos:0,money:1500,alive:true,isAI:false},
    {id:1,name:'CPU 1',color:'#3b82f6',pos:0,money:1500,alive:true,isAI:true}
  ];
  currentTurn = 0;
  diceValue = 0;
  document.getElementById('dice').textContent = '-';
  document.getElementById('propInfo').textContent = 'Tap a tile or land on it to view details.';
  logEl.innerHTML = '';
  log('Game reset.');
  renderBoard();
  renderPlayersList();
});

/* ---------- Init ---------- */
renderBoard();
renderPlayersList();
log('Ready. Full classic-style board rendered. Labels auto-abbreviate when necessary. Click Roll Dice to play.');
showProp(0);
</script>
</body>
</html>
